Kubernetes 버전 낮춰서 설치 1.20.12.00 으로 함 

sudo kubeadm init --apiserver-advertise-address=192.168.15.67 --pod-network-cidr=10.244.0.0/16 --upload-certs 

 

https://docs.kubeedge.io/en/docs/setup/keadm/ 

 

https://paastaguide.gitbook.io/paas-ta-5-5-0/guide-5.5.0-semini/install-guide/portal-1/paas-ta-container-platform-edge-deployment-guide-v1.0 

 

Keadm 설치는 ./keadm 어쩌구 

메트릭 서버는 파스타 대로 해도 됨 

 

 

 

sudo apt-get install -y apt-transport-https ca-certificates curl 

sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg 

echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list 

sudo apt-get update 

 

apt install -y kubectl=1.20.12-00 kubelet=1.20.12-00 kubeadm=1.20.12-00 

sudo apt-mark hold kubelet kubeadm kubectl 

sudo kubeadm init --apiserver-advertise-address=192.168.15.67 --pod-network-cidr=10.244.0.0/16 --upload-certs 

kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/2140ac876ef134e0ed5af15c65e414cf26827915/Documentation/kube-flannel.yml 

 

iptables -I INPUT -p tcp --dport 10000 -j ACCEPTiptables -I INPUT -p tcp --dport 10002 -j ACCEPTiptables -L -v 

wget https://github.com/kubeedge/kubeedge/releases/download/v1.8.2/keadm-v1.8.2-linux-amd64.tar.gztar -zxvf keadm-v1.8.2-linux-amd64.tar.gzcd keadm-v1.8.2-linux-amd64/keadm 

./keadm init --advertise-address=192.168.15.67 

cat /var/log/kubeedge/cloudcore.log 

git clone https://github.com/kubeedge/kubeedge.gitcd kubeedge/build/tools/ 

cp certgen.sh /etc/kubeedge/ 

/etc/kubeedge/certgen.sh stream 

kubectl get cm tunnelport -nkubeedge -oyamliptables -t nat -A OUTPUT -p tcp --dport 10351 -j DNAT --to 192.168.15.67:10003 

vi /etc/kubeedge/config/cloudcore.yaml 

pkill cloudcore 

nohup cloudcore > cloudcore.log 2>&1 & 

 

wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.4.0/components 

vi components 

kubectl taint nodes --all node-role.kubernetes.io/master- 

kubectl apply -f components 

 

 

<edge> 

vi /etc/nsswitch.conf 

sudo echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf 

sysctl -p 

 

 ./keadm join --cloudcore-ipport=192.168.15.67:10000 --token=f3908e5d65d89e33ff02d8d8ff4981646c62957b70e6f278a065ad9dffa3964b.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzcxMTc2NDh9.EO0pPIcCsho2FK6C7OgB83MQtMa7ZFf9Pcw9y1fyGMM 

journalctl -u edgecore.service -b 

 

vi /etc/kubeedge/config/edgecore.yaml 

systemctl restart edgecore.service 

 

 

 
